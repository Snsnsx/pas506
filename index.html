<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;display=swap');
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .task-text {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        #violation-banner {
            animation: slideDown 0.4s ease;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        
        .bar-container {
            height: 180px;
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }
        
        .bar {
            flex: 1;
            background: linear-gradient(180deg, #3b82f6, #1e40af);
            border-radius: 6px 6px 0 0;
            transition: height 0.3s ease;
            position: relative;
        }
        
        .bin-label {
            font-size: 10px;
            text-align: center;
            margin-top: 4px;
        }
        
        input[type="range"] {
            accent-color: #3b82f6;
        }
        
        .timer {
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen no-select">
    <!-- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ä—Ç–∞ -->
    <div id="start-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-950 to-zinc-950">
        <div class="max-w-md w-full mx-auto bg-zinc-900 rounded-3xl shadow-2xl p-10 border border-zinc-700">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-2xl mb-6">
                    <span class="text-4xl">üìä</span>
                </div>
                <h1 class="text-3xl font-semibold mb-2">–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞</h1>
                <p class="text-zinc-400">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Ä¢ 6 –∫–ª–∞—Å—Å</p>
            </div>
            
            <form id="start-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-zinc-400 mb-1">–§–∞–º–∏–ª–∏—è</label>
                    <input id="surname" type="text" required
                           class="w-full bg-zinc-800 border border-zinc-700 rounded-2xl px-5 py-4 text-lg focus:outline-none focus:border-blue-500 transition-colors"
                           placeholder="–ò–≤–∞–Ω–æ–≤">
                </div>
                <div>
                    <label class="block text-sm font-medium text-zinc-400 mb-1">–ò–º—è</label>
                    <input id="name" type="text" required
                           class="w-full bg-zinc-800 border border-zinc-700 rounded-2xl px-5 py-4 text-lg focus:outline-none focus:border-blue-500 transition-colors"
                           placeholder="–ò–≤–∞–Ω">
                </div>
                <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 transition-colors text-white font-semibold py-5 rounded-3xl text-xl">
                    –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É (20 –º–∏–Ω—É—Ç)
                </button>
            </form>
            
            <p class="text-center text-xs text-zinc-500 mt-8">
                –í—Ä–µ–º—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ ‚Ä¢ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã
            </p>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω —Ä–∞–±–æ—Ç—ã -->
    <div id="main-screen" class="hidden min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-zinc-900 border-b border-zinc-700 px-6 py-4 flex items-center justify-between sticky top-0 z-50">
            <div class="flex items-center gap-4">
                <div class="text-blue-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12m-3-9h6m-6 6h6" />
                    </svg>
                </div>
                <div>
                    <div class="text-sm text-zinc-400">–£—á–µ–Ω–∏–∫</div>
                    <div id="student-name" class="font-semibold text-lg"></div>
                </div>
            </div>
            
            <div class="flex items-center gap-8">
                <!-- –¢–∞–π–º–µ—Ä -->
                <div class="text-center">
                    <div class="text-xs text-zinc-400 tracking-widest">–û–°–¢–ê–õ–û–°–¨</div>
                    <div id="timer" class="timer text-3xl font-mono font-bold text-blue-400 tabular-nums">20:00</div>
                </div>
                
                <!-- –ó–∞–º–µ—á–∞–Ω–∏—è -->
                <div class="text-center">
                    <div class="text-xs text-zinc-400">–ó–ê–ú–ï–ß–ê–ù–ò–Ø</div>
                    <div class="flex items-center gap-1">
                        <div id="violation-count" class="text-3xl font-mono font-bold text-red-400">0</div>
                        <div class="text-zinc-500">/ 3</div>
                    </div>
                </div>
            </div>
            
            <button onclick="finishTestEarly()" 
                    class="bg-red-600/10 hover:bg-red-600/20 text-red-400 px-6 py-2 rounded-2xl text-sm font-medium transition-colors">
                –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ
            </button>
        </header>

        <div class="flex-1 overflow-auto p-6 max-w-5xl mx-auto w-full space-y-10 pb-32">
            
            <!-- –ó–∞–¥–∞–Ω–∏–µ 1 -->
            <div class="bg-zinc-900 rounded-3xl p-8 border border-zinc-700">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <div class="inline-block bg-blue-900 text-blue-300 text-xs font-medium px-4 py-1 rounded-2xl">–ó–∞–¥–∞–Ω–∏–µ 1 ‚Ä¢ 3 –±–∞–ª–ª–∞</div>
                        <h2 class="text-2xl font-semibold mt-3">–ê–Ω–∞–ª–∏–∑ —Å—Ç–æ–ª–±—á–∞—Ç–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã</h2>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-emerald-400">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞</div>
                        <div class="text-3xl font-bold text-emerald-400">+1</div>
                    </div>
                </div>
                
                <p class="task-text text-zinc-300 mb-6 leading-relaxed">
                    –ù–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–∞ (x) –∏ –∏—Ö —á–∞—Å—Ç–æ—Ç—ã (y). 
                    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–ø–∏—à–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –∏ –º–µ–¥–∏–∞–Ω—É.
                </p>
                
                <div class="bg-zinc-950 rounded-2xl p-6 mb-8">
                    <canvas id="chart1" class="w-full h-72"></canvas>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-2">–°—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ</label>
                        <input id="t1-mean" type="number" step="0.01" 
                               class="w-full bg-zinc-800 border border-zinc-700 rounded-2xl px-6 py-5 text-2xl focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-2">–ú–µ–¥–∏–∞–Ω–∞</label>
                        <input id="t1-med" type="number" step="0.01" 
                               class="w-full bg-zinc-800 border border-zinc-700 rounded-2xl px-6 py-5 text-2xl focus:outline-none focus:border-blue-500">
                    </div>
                </div>
            </div>
            
            <!-- –ó–∞–¥–∞–Ω–∏–µ 2 -->
            <div class="bg-zinc-900 rounded-3xl p-8 border border-zinc-700">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <div class="inline-block bg-blue-900 text-blue-300 text-xs font-medium px-4 py-1 rounded-2xl">–ó–∞–¥–∞–Ω–∏–µ 2 ‚Ä¢ 3 –±–∞–ª–ª–∞</div>
                        <h2 class="text-2xl font-semibold mt-3">–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</h2>
                    </div>
                    <div class="text-right text-amber-400">
                        <div class="text-xs">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–∑—É–Ω–∫–∏</div>
                    </div>
                </div>
                
                <p class="task-text text-zinc-300 mb-6 leading-relaxed">
                    –ù–∏–∂–µ –¥–∞–Ω –Ω–∞–±–æ—Ä –∏–∑ 30 –∑–Ω–∞—á–µ–Ω–∏–π. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Å—Ç–æ–ª–±—á–∞—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ 6 –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º 
                    —Å –ø–æ–º–æ—â—å—é –ø–æ–ª–∑—É–Ω–∫–æ–≤. –¢–∞–∫–∂–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –∏ –º–µ–¥–∏–∞–Ω—É.
                </p>
                
                <!-- –°–ø–∏—Å–æ–∫ –¥–∞–Ω–Ω—ã—Ö -->
                <div class="mb-8">
                    <div class="text-xs uppercase tracking-widest text-zinc-500 mb-3">–ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (30 –∑–Ω–∞—á–µ–Ω–∏–π)</div>
                    <div id="data-list" 
                         class="grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 gap-2 text-sm bg-zinc-950 p-6 rounded-2xl font-mono">
                    </div>
                </div>
                
                <!-- –ü–æ–ª–∑—É–Ω–∫–∏ —á–∞—Å—Ç–æ—Ç -->
                <div class="mb-10">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-sm font-medium">–ß–∞—Å—Ç–æ—Ç—ã –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º</div>
                        <div id="freq-sum" class="font-mono text-lg text-zinc-400">–°—É–º–º–∞: 0 / 30</div>
                    </div>
                    
                    <div id="bins-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
                        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
                    </div>
                </div>
                
                <!-- –ñ–∏–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ -->
                <div class="bg-zinc-950 rounded-2xl p-6 mb-10">
                    <canvas id="chart2" class="w-full h-64"></canvas>
                </div>
                
                <!-- –°—Ä–µ–¥–Ω–µ–µ –∏ –º–µ–¥–∏–∞–Ω–∞ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-2">–°—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ (–ø–æ–ª–∑—É–Ω–æ–∫)</label>
                        <div class="flex items-center gap-4">
                            <input id="t2-mean-slider" type="range" min="10" max="90" step="0.1" value="50"
                                   class="flex-1 accent-blue-500">
                            <div id="t2-mean-val" class="font-mono w-20 text-right text-2xl">50.0</div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-2">–ú–µ–¥–∏–∞–Ω–∞ (–ø–æ–ª–∑—É–Ω–æ–∫)</label>
                        <div class="flex items-center gap-4">
                            <input id="t2-med-slider" type="range" min="10" max="90" step="0.1" value="50"
                                   class="flex-1 accent-blue-500">
                            <div id="t2-med-val" class="font-mono w-20 text-right text-2xl">50.0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="fixed bottom-0 left-0 right-0 bg-zinc-900 border-t border-zinc-700 p-4">
            <div class="max-w-5xl mx-auto flex items-center justify-between">
                <div onclick="showRules()" 
                     class="text-blue-400 hover:text-blue-300 cursor-pointer text-sm flex items-center gap-2">
                    <span>üìã</span>
                    <span>–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã</span>
                </div>
                
                <button onclick="submitResults()" 
                        id="submit-button"
                        class="bg-emerald-600 hover:bg-emerald-700 transition-all font-semibold px-10 py-5 rounded-3xl text-lg shadow-lg shadow-emerald-900/50">
                    –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ë–∞–Ω–Ω–µ—Ä –Ω–∞—Ä—É—à–µ–Ω–∏—è -->
    <div id="violation-banner" class="hidden fixed top-0 left-0 right-0 bg-red-600 text-white py-4 px-6 z-[9999] flex items-center justify-between shadow-xl">
        <div class="flex items-center gap-4">
            <span class="text-3xl">‚ö†Ô∏è</span>
            <div>
                <div class="font-semibold">–ó–∞–º–µ—á–∞–Ω–∏–µ!</div>
                <div id="violation-reason" class="text-sm opacity-90"></div>
            </div>
        </div>
        <button onclick="hideBanner()" 
                class="bg-white/20 hover:bg-white/30 px-6 py-2 rounded-2xl text-sm">
            –ü–æ–Ω—è—Ç–Ω–æ
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è / —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div id="result-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-[10000]">
        <div class="bg-zinc-900 rounded-3xl max-w-lg w-full mx-4 p-10 text-center">
            <div id="modal-icon" class="mx-auto w-24 h-24 rounded-2xl flex items-center justify-center text-6xl mb-6"></div>
            <h2 id="modal-title" class="text-3xl font-semibold mb-2"></h2>
            <p id="modal-text" class="text-zinc-400 mb-8"></p>
            
            <div id="modal-grade" class="text-8xl font-bold mb-8"></div>
            
            <button onclick="location.reload()" 
                    class="w-full py-6 bg-zinc-800 hover:bg-zinc-700 rounded-3xl font-medium">
                –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let studentFIO = '';
        let timeLeft = 20 * 60;
        let timerInterval = null;
        let violations = 0;
        let isSubmitted = false;
        
        let chart1Instance = null;
        let chart2Instance = null;
        
        // –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è 1
        let t1_xs = [];
        let t1_ys = [];
        let t1_mean_correct = 0;
        let t1_median_correct = 0;
        let t1_total = 0;
        
        // –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è 2
        let t2_numbers = [];
        let t2_bins = [];
        let t2_correct_freq = [];
        let t2_mean_correct = 0;
        let t2_median_correct = 0;
        
        let studentFreq = [0,0,0,0,0,0];
        
        const GOOGLE_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyYnkaJLYbhCo_6tSv-ULbxm8UAwnuc4cSM2KfOJg1F4MYaquGPWmXjS6bbUn3FSyO8lQ/exec"; 
        // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π URL –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è Apps Script

        // ==================== –ó–ê–©–ò–¢–ê –û–¢ –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø –ò –°–ö–†–ò–ù–®–û–¢–û–í ====================
        function setupProtection() {
            // –ó–∞–ø—Ä–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            document.addEventListener('copy', (e) => {
                e.preventDefault();
                addViolation('–ü–æ–ø—ã—Ç–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞');
            });
            document.addEventListener('cut', (e) => {
                e.preventDefault();
                addViolation('–ü–æ–ø—ã—Ç–∫–∞ –≤—ã—Ä–µ–∑–∞–Ω–∏—è');
            });
            document.addEventListener('paste', (e) => {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    addViolation('–ü–æ–ø—ã—Ç–∫–∞ –≤—Å—Ç–∞–≤–∫–∏');
                }
            });
            
            // –ó–∞–ø—Ä–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
            document.addEventListener('contextmenu', (e) => {
                if (!e.target.closest('input, textarea')) {
                    e.preventDefault();
                    addViolation('–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é');
                }
            });
            
            // PrintScreen
            document.addEventListener('keydown', (e) => {
                if (e.key === 'PrintScreen' || e.keyCode === 44) {
                    addViolation('–ü–æ–ø—ã—Ç–∫–∞ —Å–Ω–∏–º–∫–∞ —ç–∫—Ä–∞–Ω–∞ (PrintScreen)');
                    e.preventDefault();
                }
            });
            
            // –ü–æ–∫–∏–Ω—É–ª–∏ –≤–∫–ª–∞–¥–∫—É / —Å–≤–µ—Ä–Ω—É–ª–∏
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden' && !isSubmitted) {
                    addViolation('–°–º–µ–Ω–∞ –≤–∫–ª–∞–¥–∫–∏ –∏–ª–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –æ–∫–Ω–∞');
                }
            });
            
            // –ü–æ–ø—ã—Ç–∫–∞ —É—Ö–æ–¥–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('beforeunload', (e) => {
                if (!isSubmitted) {
                    addViolation('–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—å/–ø–µ—Ä–µ–π—Ç–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
                    e.preventDefault();
                    e.returnValue = '–í—ã —É–≤–µ—Ä–µ–Ω—ã? –†–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞!';
                }
            });
            
            // –ó–∞–ø—Ä–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤—Å—ë–º –∫—Ä–æ–º–µ –∏–Ω–ø—É—Ç–æ–≤
            document.documentElement.style.setProperty('--tw-user-select', 'none');
        }

        function addViolation(reason) {
            if (isSubmitted) return;
            violations++;
            document.getElementById('violation-count').textContent = violations;
            
            if (violations === 2) {
                showToast('–í–Ω–∏–º–∞–Ω–∏–µ! –ü—Ä–∏ 3-–º –∑–∞–º–µ—á–∞–Ω–∏–∏ —Ä–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞.', 'amber');
            }
            if (violations >= 3) {
                annulTest();
                return;
            }
            
            const banner = document.getElementById('violation-banner');
            document.getElementById('violation-reason').innerHTML = reason + `<br><span class="text-xs">–ó–∞–º–µ—á–∞–Ω–∏–µ ${violations}/3</span>`;
            banner.classList.remove('hidden');
            setTimeout(() => {
                if (violations < 3) banner.classList.add('hidden');
            }, 6500);
        }

        function hideBanner() {
            document.getElementById('violation-banner').classList.add('hidden');
        }

        function showToast(msg, color = 'red') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-20 left-1/2 -translate-x-1/2 bg-${color}-600 text-white px-8 py-4 rounded-3xl shadow-2xl text-sm z-[99999]`;
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        // ==================== –ì–ï–ù–ï–†–ê–¶–ò–Ø –î–ê–ù–ù–´–• ====================
        function generateTask1() {
            t1_xs = [];
            while (t1_xs.length < 6) {
                const val = Math.floor(Math.random() * 36) + 15;
                if (!t1_xs.includes(val)) t1_xs.push(val);
            }
            t1_xs.sort((a, b) => a - b);
            
            t1_ys = Array.from({length: 6}, () => Math.floor(Math.random() * 9) + 4);
            t1_total = t1_ys.reduce((a, b) => a + b, 0);
            
            let sum = 0;
            for (let i = 0; i < 6; i++) sum += t1_xs[i] * t1_ys[i];
            t1_mean_correct = parseFloat((sum / t1_total).toFixed(2));
            
            // –ú–µ–¥–∏–∞–Ω–∞
            let positions = [];
            let cum = 0;
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < t1_ys[i]; j++) {
                    positions.push(t1_xs[i]);
                }
            }
            const mid = Math.floor(t1_total / 2);
            if (t1_total % 2 === 1) {
                t1_median_correct = positions[mid];
            } else {
                t1_median_correct = parseFloat(((positions[mid - 1] + positions[mid]) / 2).toFixed(2));
            }
        }

        function generateTask2() {
            t2_numbers = [];
            for (let i = 0; i < 30; i++) {
                t2_numbers.push(Math.floor(Math.random() * 71) + 20); // 20..90
            }
            t2_numbers.sort((a, b) => a - b);
            
            const minVal = Math.min(...t2_numbers);
            const maxVal = Math.max(...t2_numbers);
            const range = maxVal - minVal;
            const binWidth = Math.ceil(range / 6);
            
            t2_bins = [];
            for (let i = 0; i < 6; i++) {
                const low = minVal + i * binWidth;
                const high = (i === 5) ? maxVal : low + binWidth - 1;
                t2_bins.push({low, high, label: `${low}‚Äì${high}`});
            }
            
            t2_correct_freq = new Array(6).fill(0);
            t2_numbers.forEach(num => {
                for (let i = 0; i < 6; i++) {
                    if (num >= t2_bins[i].low && num <= t2_bins[i].high) {
                        t2_correct_freq[i]++;
                        break;
                    }
                }
            });
            
            const sum = t2_numbers.reduce((a, b) => a + b, 0);
            t2_mean_correct = parseFloat((sum / 30).toFixed(2));
            t2_median_correct = parseFloat(((t2_numbers[14] + t2_numbers[15]) / 2).toFixed(2));
        }

        // ==================== –û–¢–†–ò–°–û–í–ö–ê ====================
        function renderTask1() {
            const ctx = document.getElementById('chart1');
            if (chart1Instance) chart1Instance.destroy();
            
            chart1Instance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: t1_xs,
                    datasets: [{
                        label: '–ß–∞—Å—Ç–æ—Ç–∞',
                        data: t1_ys,
                        backgroundColor: '#3b82f6',
                        borderColor: '#1e40af',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#27272a' }, ticks: { color: '#a1a1aa' } },
                        x: { grid: { color: '#27272a' }, ticks: { color: '#a1a1aa' } }
                    }
                }
            });
        }

        function renderDataList() {
            const container = document.getElementById('data-list');
            container.innerHTML = '';
            t2_numbers.forEach(num => {
                const div = document.createElement('div');
                div.className = 'bg-zinc-900 px-3 py-2 rounded-xl text-center font-semibold text-emerald-300';
                div.textContent = num;
                container.appendChild(div);
            });
        }

        function renderBins() {
            const container = document.getElementById('bins-container');
            container.innerHTML = '';
            
            t2_bins.forEach((bin, i) => {
                const div = document.createElement('div');
                div.className = 'bg-zinc-800 rounded-2xl p-5';
                div.innerHTML = `
                    <div class="text-xs text-zinc-400 mb-3">${bin.label}</div>
                    <input type="range" min="0" max="30" value="0" id="freq-slider-${i}"
                           class="w-full accent-blue-500 mb-4">
                    <div class="flex justify-between items-baseline">
                        <span class="text-xs text-zinc-500">—á–∞—Å—Ç–æ—Ç–∞</span>
                        <span id="freq-val-${i}" class="font-mono text-3xl font-semibold text-blue-400">0</span>
                    </div>
                `;
                container.appendChild(div);
                
                const slider = div.querySelector('input');
                const valSpan = div.querySelector(`#freq-val-${i}`);
                
                slider.addEventListener('input', () => {
                    studentFreq[i] = parseInt(slider.value);
                    valSpan.textContent = studentFreq[i];
                    updateFreqSum();
                    updateChart2();
                });
            });
        }

        function updateFreqSum() {
            const sum = studentFreq.reduce((a, b) => a + b, 0);
            document.getElementById('freq-sum').textContent = `–°—É–º–º–∞: ${sum} / 30`;
        }

        function renderTask2Chart() {
            const ctx = document.getElementById('chart2');
            if (chart2Instance) chart2Instance.destroy();
            
            chart2Instance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: t2_bins.map(b => b.label),
                    datasets: [{
                        label: '–í–∞—à–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞',
                        data: studentFreq,
                        backgroundColor: '#64748b',
                        borderColor: '#475569',
                        borderWidth: 2,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { max: 30, beginAtZero: true, grid: { color: '#27272a' } },
                        x: { grid: { color: '#27272a' } }
                    }
                }
            });
        }

        function updateChart2() {
            if (chart2Instance) {
                chart2Instance.data.datasets[0].data = studentFreq;
                chart2Instance.update('none');
            }
        }

        function setupSlidersTask2() {
            const meanSlider = document.getElementById('t2-mean-slider');
            const meanVal = document.getElementById('t2-mean-val');
            meanSlider.addEventListener('input', () => {
                meanVal.textContent = parseFloat(meanSlider.value).toFixed(1);
            });
            
            const medSlider = document.getElementById('t2-med-slider');
            const medVal = document.getElementById('t2-med-val');
            medSlider.addEventListener('input', () => {
                medVal.textContent = parseFloat(medSlider.value).toFixed(1);
            });
        }

        // ==================== –¢–ê–ô–ú–ï–† ====================
        function startTimer() {
            const timerEl = document.getElementById('timer');
            
            timerInterval = setInterval(() => {
                timeLeft--;
                const min = Math.floor(timeLeft / 60);
                const sec = timeLeft % 60;
                timerEl.textContent = `${min}:${sec < 10 ? '0' : ''}${sec}`;
                
                if (timeLeft <= 300) {
                    timerEl.classList.add('text-red-400');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finishTest(true);
                }
            }, 1000);
        }

        // ==================== –ü–û–î–°–ß–Å–¢ –ë–ê–õ–õ–û–í ====================
        function calculateScore() {
            let score = 1; // –ó–∞–¥–∞–Ω–∏–µ 1 ‚Äî –¥–∏–∞–≥—Ä–∞–º–º–∞ (–∞–≤—Ç–æ)
            
            // –ó–∞–¥–∞–Ω–∏–µ 1: —Å—Ä–µ–¥–Ω–µ–µ –∏ –º–µ–¥–∏–∞–Ω–∞ (–ø–æ 1 –±–∞–ª–ª—É)
            const t1MeanStud = parseFloat(document.getElementById('t1-mean').value) || 0;
            const t1MedStud = parseFloat(document.getElementById('t1-med').value) || 0;
            
            if (Math.abs(t1MeanStud - t1_mean_correct) <= 0.5) score += 1;
            if (Math.abs(t1MedStud - t1_median_correct) <= 0.5) score += 1;
            
            score += 1; // –ó–∞–¥–∞–Ω–∏–µ 2 ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã (–±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∏–∂–µ)
            
            // –ó–∞–¥–∞–Ω–∏–µ 2: —á–∞—Å—Ç–æ—Ç—ã
            let freqOk = true;
            let freqDiffSum = 0;
            for (let i = 0; i < 6; i++) {
                const diff = Math.abs(studentFreq[i] - t2_correct_freq[i]);
                freqDiffSum += diff;
                if (diff > 2) freqOk = false;
            }
            if (freqOk && Math.abs(studentFreq.reduce((a,b)=>a+b,0) - 30) <= 3) {
                score += 1; // +1 –∑–∞ –¥–∏–∞–≥—Ä–∞–º–º—É
            } else {
                score -= 1; // –Ω–µ –¥–∞—ë–º –±–∞–ª–ª –∑–∞ –¥–∏–∞–≥—Ä–∞–º–º—É
            }
            
            // –ó–∞–¥–∞–Ω–∏–µ 2: —Å—Ä–µ–¥–Ω–µ–µ –∏ –º–µ–¥–∏–∞–Ω–∞
            const t2MeanStud = parseFloat(document.getElementById('t2-mean-slider').value);
            const t2MedStud = parseFloat(document.getElementById('t2-med-slider').value);
            
            if (Math.abs(t2MeanStud - t2_mean_correct) <= 0.6) score += 1;
            if (Math.abs(t2MedStud - t2_median_correct) <= 0.6) score += 1;
            
            // –®—Ç—Ä–∞—Ñ –∑–∞ –∑–∞–º–µ—á–∞–Ω–∏—è
            let finalScore = Math.max(0, score);
            if (violations === 2) finalScore = Math.max(0, finalScore - 1);
            if (violations >= 3) finalScore = 0;
            
            return {
                rawScore: score,
                finalScore: finalScore,
                grade: getGrade(finalScore),
                details: {
                    t1_mean_student: t1MeanStud,
                    t1_med_student: t1MedStud,
                    t2_freq_student: studentFreq,
                    t2_mean_student: t2MeanStud,
                    t2_med_student: t2MedStud
                }
            };
        }

        function getGrade(points) {
            if (violations >= 3) return '–ê–ù–ù–£–õ–ò–†–û–í–ê–ù–û';
            if (points >= 6) return '5';
            if (points >= 5) return '4';
            if (points >= 3) return '3';
            return '2';
        }

        function showResultModal(scoreObj) {
            const modal = document.getElementById('result-modal');
            const icon = document.getElementById('modal-icon');
            const title = document.getElementById('modal-title');
            const text = document.getElementById('modal-text');
            const gradeEl = document.getElementById('modal-grade');
            
            if (scoreObj.finalScore === 0 && violations >= 3) {
                icon.innerHTML = '‚õî';
                icon.style.backgroundColor = '#7f1d1d';
                title.textContent = '–†–∞–±–æ—Ç–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞';
                text.textContent = '–í—ã –ø–æ–ª—É—á–∏–ª–∏ 3 –∏ –±–æ–ª–µ–µ –∑–∞–º–µ—á–∞–Ω–∏–π.';
                gradeEl.textContent = '0';
                gradeEl.style.color = '#ef4444';
            } else {
                icon.innerHTML = 'üèÜ';
                icon.style.backgroundColor = '#166534';
                title.textContent = '–†–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
                text.innerHTML = `–ù–∞–±—Ä–∞–Ω–æ –±–∞–ª–ª–æ–≤: <span class="font-mono">${scoreObj.finalScore}</span>/6`;
                gradeEl.textContent = scoreObj.grade;
                if (scoreObj.grade === '5') gradeEl.style.color = '#22c55e';
                else if (scoreObj.grade === '4') gradeEl.style.color = '#eab308';
                else gradeEl.style.color = '#f59e0b';
            }
            
            modal.classList.remove('hidden');
        }

        // ==================== –û–¢–ü–†–ê–í–ö–ê –ù–ê GOOGLE SHEETS ====================
        async function sendToGoogleSheets(data) {
            if (GOOGLE_WEBAPP_URL.includes('your-real-web-app-url')) {
                console.warn('‚ö†Ô∏è Google Apps Script URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ.');
                return;
            }
            
            try {
                await fetch(GOOGLE_WEBAPP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Google Sheets', e);
            }
        }

        function submitResults() {
            if (isSubmitted) return;
            isSubmitted = true;
            clearInterval(timerInterval);
            
            const scoreObj = calculateScore();
            
            const resultData = {
                timestamp: new Date().toISOString(),
                fio: studentFIO,
                violations: violations,
                raw_points: scoreObj.rawScore,
                final_points: scoreObj.finalScore,
                grade: scoreObj.grade,
                t1_mean_correct: t1_mean_correct,
                t1_median_correct: t1_median_correct,
                t2_mean_correct: t2_mean_correct,
                t2_median_correct: t2_median_correct,
                ...scoreObj.details
            };
            
            sendToGoogleSheets(resultData);
            showResultModal(scoreObj);
        }

        function finishTestEarly() {
            if (confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É –¥–æ—Å—Ä–æ—á–Ω–æ?')) {
                submitResults();
            }
        }

        function finishTest(timeExpired = false) {
            if (isSubmitted) return;
            if (timeExpired) {
                showToast('–í—Ä–µ–º—è –≤—ã—à–ª–æ! –†–∞–±–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.', 'amber');
            }
            submitResults();
        }

        function annulTest() {
            isSubmitted = true;
            clearInterval(timerInterval);
            const scoreObj = { finalScore: 0, grade: '–ê–ù–ù–£–õ–ò–†–û–í–ê–ù–û' };
            showResultModal(scoreObj);
        }

        function showRules() {
            alert('üìå –ü—Ä–∞–≤–∏–ª–∞:\n‚Ä¢ 20 –º–∏–Ω—É—Ç –Ω–∞ –≤—Å—é —Ä–∞–±–æ—Ç—É\n‚Ä¢ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, —Å–º–µ–Ω–∞ –≤–∫–ª–∞–¥–∫–∏ ‚Äî –∑–∞–º–µ—á–∞–Ω–∏–µ\n‚Ä¢ 2 –∑–∞–º–µ—á–∞–Ω–∏—è = ‚àí1 –±–∞–ª–ª\n‚Ä¢ 3 –∑–∞–º–µ—á–∞–Ω–∏—è = –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ\n‚Ä¢ –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —É—á–∏—Ç–µ–ª—é');
        }

        // ==================== –°–¢–ê–†–¢ ====================
        function startTest(e) {
            e.preventDefault();
            
            const surname = document.getElementById('surname').value.trim();
            const name = document.getElementById('name').value.trim();
            
            if (!surname || !name) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è!');
                return;
            }
            
            studentFIO = `${surname} ${name}`;
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            document.getElementById('student-name').textContent = studentFIO;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            generateTask1();
            generateTask2();
            
            // –†–µ–Ω–¥–µ—Ä–∏–º
            renderTask1();
            renderDataList();
            renderBins();
            renderTask2Chart();
            setupSlidersTask2();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –∏ –∑–∞—â–∏—Ç—É
            startTimer();
            setupProtection();
            
            // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É–º–º—ã —á–∞—Å—Ç–æ—Ç –∫–∞–∂–¥—ã–µ 800–º—Å (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
            setInterval(updateFreqSum, 800);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            document.getElementById('start-form').addEventListener('submit', startTest);
            
            // –î–µ–ª–∞–µ–º Tailwind –≥–æ—Ç–æ–≤—ã–º
            console.log('%c‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ\n–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞', 'color:#22d3ee; font-family:monospace');
        };
    </script>
</body>
</html>
