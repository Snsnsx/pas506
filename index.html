<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞</title>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;800&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
<style>
  :root {
    --bg: #0f0e17;
    --surface: #1a1929;
    --surface2: #242338;
    --accent: #ff6b35;
    --accent2: #f7c59f;
    --green: #2ec4b6;
    --red: #e63946;
    --text: #fffffe;
    --text-muted: #a7a9be;
    --border: rgba(255,255,255,0.08);
    --radius: 16px;
    --shadow: 0 8px 32px rgba(0,0,0,0.4);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-user-select: none;
    user-select: none;
  }

  /* Noise texture overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.5;
  }

  /* ========= SCREENS ========= */
  .screen { display: none; position: relative; z-index: 1; }
  .screen.active { display: flex; flex-direction: column; min-height: 100vh; }

  /* ========= REGISTRATION ========= */
  #screen-reg {
    align-items: center;
    justify-content: center;
    padding: 24px;
    background: radial-gradient(ellipse at 50% 0%, rgba(255,107,53,0.15) 0%, transparent 60%);
  }

  .reg-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 40px 32px;
    width: 100%;
    max-width: 420px;
    box-shadow: var(--shadow);
    animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes slideUp {
    from { transform: translateY(40px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .logo-area {
    text-align: center;
    margin-bottom: 32px;
  }

  .logo-icon {
    width: 64px; height: 64px;
    background: linear-gradient(135deg, var(--accent), #ff9a6c);
    border-radius: 18px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    margin-bottom: 16px;
    box-shadow: 0 0 40px rgba(255,107,53,0.3);
  }

  .logo-title {
    font-family: 'Unbounded', sans-serif;
    font-size: 22px;
    font-weight: 800;
    color: var(--text);
  }

  .logo-sub {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 4px;
  }

  .form-group { margin-bottom: 20px; }

  .form-label {
    display: block;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 8px;
  }

  .form-input {
    width: 100%;
    background: var(--surface2);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-size: 16px;
    padding: 14px 16px;
    transition: border-color 0.2s;
    outline: none;
    -webkit-user-select: text;
    user-select: text;
  }

  .form-input:focus { border-color: var(--accent); }

  .variant-preview {
    text-align: center;
    padding: 12px 16px;
    background: rgba(46,196,182,0.08);
    border: 1px dashed rgba(46,196,182,0.3);
    border-radius: 12px;
    color: var(--green);
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 20px;
    letter-spacing: 0.5px;
  }

  select.form-input option { background: var(--surface2); }

  .btn-primary {
    width: 100%;
    background: linear-gradient(135deg, var(--accent), #ff8c5a);
    color: white;
    border: none;
    border-radius: 12px;
    font-family: 'Unbounded', sans-serif;
    font-size: 14px;
    font-weight: 600;
    padding: 16px;
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
    box-shadow: 0 4px 20px rgba(255,107,53,0.4);
    margin-top: 8px;
  }

  .btn-primary:active { transform: scale(0.97); }

  .rules-hint {
    margin-top: 20px;
    padding: 14px;
    background: rgba(255,107,53,0.08);
    border: 1px solid rgba(255,107,53,0.2);
    border-radius: 10px;
    font-size: 12px;
    color: var(--text-muted);
    line-height: 1.6;
    text-align: center;
  }

  /* ========= TEST SCREEN ========= */
  #screen-test {
    flex-direction: column;
    padding-bottom: 100px;
  }

  /* Header */
  .test-header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(15,14,23,0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
  }

  .student-name {
    font-size: 13px;
    font-weight: 700;
    color: var(--accent2);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 140px;
  }

  .timer-wrap {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 8px 14px;
  }

  .timer-icon { font-size: 16px; }

  #timer-display {
    font-family: 'Unbounded', sans-serif;
    font-size: 18px;
    font-weight: 600;
    color: var(--green);
    letter-spacing: 2px;
    transition: color 0.3s;
  }

  #timer-display.warning { color: var(--accent); }
  #timer-display.danger { color: var(--red); animation: pulse 1s infinite; }

  @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }

  .progress-bar {
    height: 3px;
    background: var(--surface2);
    position: relative;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--green));
    transition: width 0.3s;
    width: 0%;
  }

  /* Questions */
  .questions-container {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-width: 700px;
    margin: 0 auto;
    width: 100%;
  }

  .section-title {
    font-family: 'Unbounded', sans-serif;
    font-size: 11px;
    font-weight: 600;
    color: var(--text-muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 8px 0 4px;
  }

  .question-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    transition: border-color 0.2s, box-shadow 0.2s;
    animation: fadeIn 0.4s ease both;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .question-card.answered {
    border-color: rgba(46,196,182,0.3);
    background: rgba(46,196,182,0.04);
  }

  .question-header {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 14px;
  }

  .q-num {
    background: linear-gradient(135deg, var(--accent), #ff8c5a);
    color: white;
    font-family: 'Unbounded', sans-serif;
    font-size: 11px;
    font-weight: 700;
    width: 28px; height: 28px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .question-card.answered .q-num {
    background: linear-gradient(135deg, var(--green), #27a99e);
  }

  .q-text {
    font-size: 14px;
    line-height: 1.6;
    color: var(--text);
    flex: 1;
  }

  .q-formula {
    margin: 8px 0 14px;
    padding: 12px 16px;
    background: var(--surface2);
    border-radius: 10px;
    font-size: 15px;
    text-align: center;
    overflow-x: auto;
  }

  .answer-input {
    width: 100%;
    background: var(--surface2);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-size: 16px;
    padding: 12px 14px;
    outline: none;
    transition: border-color 0.2s;
    -webkit-user-select: text;
    user-select: text;
    -webkit-appearance: none;
  }

  .answer-input:focus { border-color: var(--accent); }
  .answer-input.filled { border-color: var(--green); }
  .answer-input::placeholder { color: rgba(167,169,190,0.4); }

  /* Bottom nav */
  .bottom-bar {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: rgba(15,14,23,0.92);
    backdrop-filter: blur(12px);
    border-top: 1px solid var(--border);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    z-index: 100;
  }

  .answered-count {
    font-size: 13px;
    color: var(--text-muted);
    white-space: nowrap;
  }

  .answered-count span {
    color: var(--green);
    font-weight: 700;
    font-size: 16px;
  }

  .btn-submit {
    background: linear-gradient(135deg, var(--green), #27a99e);
    color: white;
    border: none;
    border-radius: 10px;
    font-family: 'Unbounded', sans-serif;
    font-size: 12px;
    font-weight: 600;
    padding: 12px 20px;
    cursor: pointer;
    transition: transform 0.15s;
    white-space: nowrap;
  }

  .btn-submit:active { transform: scale(0.96); }

  /* ========= OVERLAYS ========= */
  .overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(8px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .overlay.show { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 32px 24px;
    max-width: 380px;
    width: 100%;
    text-align: center;
    animation: popIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes popIn {
    from { transform: scale(0.85); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .modal-icon { font-size: 48px; margin-bottom: 16px; }

  .modal-title {
    font-family: 'Unbounded', sans-serif;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 10px;
  }

  .modal-text {
    font-size: 14px;
    color: var(--text-muted);
    line-height: 1.6;
    margin-bottom: 24px;
  }

  .modal-badge {
    display: inline-block;
    background: rgba(230,57,70,0.15);
    border: 1px solid rgba(230,57,70,0.3);
    color: var(--red);
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 6px;
    margin-bottom: 12px;
  }

  .btn-modal {
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 10px;
    font-family: 'Nunito', sans-serif;
    font-size: 14px;
    font-weight: 700;
    padding: 12px 28px;
    cursor: pointer;
    width: 100%;
  }

  /* Violation banner */
  .violation-banner {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0;
    background: var(--red);
    color: white;
    padding: 10px 16px;
    font-size: 13px;
    font-weight: 700;
    text-align: center;
    z-index: 500;
    animation: slideDown 0.3s ease;
  }

  @keyframes slideDown {
    from { transform: translateY(-100%); }
    to { transform: translateY(0); }
  }

  .violation-banner.show { display: block; }

  /* ========= RESULT SCREEN ========= */
  #screen-result {
    align-items: center;
    justify-content: center;
    padding: 24px;
    background: radial-gradient(ellipse at 50% 0%, rgba(46,196,182,0.1) 0%, transparent 60%);
  }

  .result-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 40px 28px;
    width: 100%;
    max-width: 480px;
    box-shadow: var(--shadow);
    animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .result-score {
    text-align: center;
    margin-bottom: 28px;
  }

  .score-circle {
    width: 110px;
    height: 110px;
    border-radius: 50%;
    background: conic-gradient(var(--green) var(--pct, 0%), var(--surface2) 0%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    position: relative;
  }

  .score-circle::before {
    content: '';
    position: absolute;
    width: 84px; height: 84px;
    background: var(--surface);
    border-radius: 50%;
  }

  .score-number {
    font-family: 'Unbounded', sans-serif;
    font-size: 26px;
    font-weight: 800;
    position: relative;
    z-index: 1;
  }

  .score-label {
    font-size: 15px;
    color: var(--text-muted);
  }

  .answers-review {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 24px;
  }

  .answer-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    background: var(--surface2);
    border-radius: 10px;
    font-size: 13px;
    gap: 8px;
  }

  .answer-row .q-label { color: var(--text-muted); }

  .answer-row .yours { font-weight: 700; }
  .answer-row .correct-ans { color: var(--green); font-size: 12px; }

  .answer-row .status { font-size: 16px; flex-shrink: 0; }

  .result-name {
    font-family: 'Unbounded', sans-serif;
    font-size: 16px;
    text-align: center;
    margin-bottom: 4px;
  }

  .result-meta {
    text-align: center;
    font-size: 13px;
    color: var(--text-muted);
    margin-bottom: 28px;
  }

  .send-status {
    text-align: center;
    font-size: 13px;
    color: var(--text-muted);
    padding: 12px;
    background: var(--surface2);
    border-radius: 10px;
  }

  /* Annulled */
  #screen-annulled {
    align-items: center;
    justify-content: center;
    padding: 24px;
  }

  .annulled-card {
    background: var(--surface);
    border: 1px solid rgba(230,57,70,0.3);
    border-radius: 24px;
    padding: 48px 28px;
    width: 100%;
    max-width: 380px;
    text-align: center;
    animation: slideUp 0.4s ease;
  }

  /* ========= Misc ========= */
  .variant-tag {
    display: inline-block;
    background: rgba(255,107,53,0.12);
    border: 1px solid rgba(255,107,53,0.25);
    color: var(--accent);
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 3px 8px;
    border-radius: 6px;
    margin-bottom: 4px;
  }
</style>
</head>
<body>

<!-- ============ SCREEN: REGISTRATION ============ -->
<div id="screen-reg" class="screen active">
  <div class="reg-card">
    <div class="logo-area">
      <div class="logo-icon">üìù</div>
      <div class="logo-title">–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞</div>
      <div class="logo-sub">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ¬∑ 40 –º–∏–Ω—É—Ç</div>
    </div>

    <div class="form-group">
      <label class="form-label" for="inp-surname">–§–∞–º–∏–ª–∏—è</label>
      <input class="form-input" id="inp-surname" type="text" placeholder="–ò–≤–∞–Ω–æ–≤" autocomplete="off">
    </div>
    <div class="form-group">
      <label class="form-label" for="inp-name">–ò–º—è</label>
      <input class="form-input" id="inp-name" type="text" placeholder="–ò–≤–∞–Ω" autocomplete="off">
    </div>
    <div class="variant-preview" id="variant-preview">
      üé≤ –í–∞—Ä–∏–∞–Ω—Ç –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω —Å–ª—É—á–∞–π–Ω–æ
    </div>
    <button class="btn-primary" onclick="startTest()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚Üí</button>
    <div class="rules-hint">
      ‚ö†Ô∏è –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω—ã.<br>–ù–∞—Ä—É—à–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∏ –º–æ–≥—É—Ç –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É.
    </div>
  </div>
</div>

<!-- ============ SCREEN: TEST ============ -->
<div id="screen-test" class="screen">
  <div class="violation-banner" id="violation-banner">‚õî –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ! –û—Å—Ç–∞–≤–∞–π—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</div>

  <div class="test-header">
    <div>
      <div class="variant-tag" id="header-variant">–í–ê–†–ò–ê–ù–¢ ‚Äî</div>
      <div class="student-name" id="header-name">‚Äî</div>
    </div>
    <div class="timer-wrap">
      <span class="timer-icon">‚è±</span>
      <span id="timer-display">40:00</span>
    </div>
  </div>

  <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

  <div class="questions-container" id="questions-container"></div>

  <div class="bottom-bar">
    <div class="answered-count">–û—Ç–≤–µ—á–µ–Ω–æ: <span id="ans-count">0</span> / 11</div>
    <button class="btn-submit" onclick="confirmSubmit()">–°–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚úì</button>
  </div>
</div>

<!-- ============ SCREEN: RESULT ============ -->
<div id="screen-result" class="screen">
  <div class="result-card">
    <div class="result-name" id="res-name"></div>
    <div class="result-meta" id="res-meta"></div>
    <div class="result-score">
      <div class="score-circle" id="score-circle">
        <span class="score-number" id="score-number">0/11</span>
      </div>
      <div class="score-label">–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
    </div>
    <div class="answers-review" id="answers-review"></div>
    <div class="send-status" id="send-status">üì° –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</div>
  </div>
</div>

<!-- ============ SCREEN: ANNULLED ============ -->
<div id="screen-annulled" class="screen">
  <div class="annulled-card">
    <div class="modal-icon">üö´</div>
    <div class="modal-title" style="color:var(--red)">–†–∞–±–æ—Ç–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞</div>
    <div class="modal-text">–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –±–æ–ª–µ–µ 2 –Ω–∞—Ä—É—à–µ–Ω–∏–π (–ø–æ–ø—ã—Ç–∫–∏ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞).<br><br>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω—ã. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —É—á–∏—Ç–µ–ª—é.</div>
  </div>
</div>

<!-- ============ OVERLAYS ============ -->
<div class="overlay" id="overlay-violation">
  <div class="modal">
    <div class="modal-icon">‚ö†Ô∏è</div>
    <div class="modal-badge" id="violation-count-badge">–ù–∞—Ä—É—à–µ–Ω–∏–µ 1 –∏–∑ 2</div>
    <div class="modal-title">–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ!</div>
    <div class="modal-text" id="violation-modal-text">–í—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. –≠—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã.<br><br>–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞—Ä—É—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞.</div>
    <button class="btn-modal" onclick="dismissViolation()">–ü–æ–Ω—è–ª, –ø—Ä–æ–¥–æ–ª–∂–∞—é —Ä–∞–±–æ—Ç—É</button>
  </div>
</div>

<div class="overlay" id="overlay-confirm">
  <div class="modal">
    <div class="modal-icon">üì¨</div>
    <div class="modal-title">–°–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É?</div>
    <div class="modal-text" id="confirm-text">–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ <b id="confirm-ans">0</b> –∏–∑ 11 –≤–æ–ø—Ä–æ—Å–æ–≤. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –±—É–¥–µ—Ç –Ω–µ–ª—å–∑—è.</div>
    <div style="display:flex;gap:10px">
      <button class="btn-modal" style="background:var(--surface2);color:var(--text-muted)" onclick="closeOverlay('overlay-confirm')">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn-modal" onclick="submitTest()">–°–¥–∞—Ç—å ‚Üí</button>
    </div>
  </div>
</div>

<div class="overlay" id="overlay-timeout">
  <div class="modal">
    <div class="modal-icon">‚åõ</div>
    <div class="modal-title">–í—Ä–µ–º—è –≤—ã—à–ª–æ!</div>
    <div class="modal-text">40 –º–∏–Ω—É—Ç –∏—Å—Ç–µ–∫–ª–æ. –í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.</div>
    <button class="btn-modal" onclick="submitTest()">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
  </div>
</div>

<script>
// ============================================================
// GOOGLE APPS SCRIPT URL ‚Äî –≤—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π URL –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
// ============================================================
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw2M11iV29ivt8gZatIjiG-QWes2gI5xrnNyxlvsLoqrHkWkXkyeN2r57jShVbaUkINGw/exec';

// ============================================================
// Variant Generator
// ============================================================
function rnd(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
function round(x, n = 2) { return Number(x.toFixed(n)); }

function variant(id) {
  // Use seeded-ish: multiply id to spread values
  Math.seedrng = function(s){ return ()=>(s=(s*9301+49297)%233280)/233280; };
  // We just use Math.random but re-seed via deterministic sequence per variant
  // Actually use fresh random each call (each student gets their own random variant)
  let a = rnd(2,9), b = rnd(2,9);
  let q1 = `${a} \\cdot (-${b})`, a1 = -a*b;

  let d1 = rnd(10,99)/10, d2 = rnd(10,99)/10;
  let q2 = `${d1} \\cdot ${d2}`, a2 = round(d1*d2);

  let p = rnd(10,70), n = rnd(200,5000);
  let q3text = `${p}% –æ—Ç ${n}`, a3 = round(n*p/100);

  let num = rnd(1,9), den = rnd(2,9);
  let q4 = `\\dfrac{${num}}{${den}}`, a4 = round(num/den);

  let m1 = rnd(100,400), m2 = rnd(100,400), c1 = rnd(10,30), c2 = rnd(30,60);
  let q5text = `${m1} –≥ (${c1}%), ${m2} –≥ (${c2}%)`, a5 = round((m1*c1+m2*c2)/(m1+m2));

  let k = rnd(11,99)/10;
  let q6 = `${k} \\cdot 3 + ${k} \\cdot 7`, a6 = round(k*(3+7));

  let x = rnd(-5,5), y = rnd(-5,5);
  let q7 = `${x}^2 - 2 \\cdot (${y})`, a7 = x*x-2*y;

  let root = rnd(-5,5), coef = rnd(2,6);
  let q8 = `${coef}x = ${coef*root}`, a8 = root;

  let cargo = rnd(3,15), cap = rnd(2,5);
  let q9text = `${cargo} —Ç, ${cap} —Ç –∑–∞ —Ä–µ–π—Å`, a9 = Math.ceil(cargo/cap);

  let r1 = rnd(1,5), r2 = rnd(1,5), part = rnd(10,200);
  let q10text = `${r1}:${r2}, —á–∞—Å—Ç—å = ${part}`, a10 = round((r1+r2)*part);

  let side = rnd(2,12), other = rnd(2,12);
  let q11text = `—Å—Ç–æ—Ä–æ–Ω—ã ${side} –∏ ${other}`, a11 = 2*(side+other);

  return {
    questions: [
      { text: '–ù–∞–π–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ:', formula: q1 },
      { text: '–í—ã—á–∏—Å–ª–∏—Ç–µ:', formula: q2 },
      { text: `–ù–∞–π–¥–∏—Ç–µ ${q3text}`, formula: null },
      { text: '–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –≤ –≤–∏–¥–µ –¥–µ—Å—è—Ç–∏—á–Ω–æ–π –¥—Ä–æ–±–∏:', formula: q4 },
      { text: `–°–º–µ—Å—å: ${q5text}. –ù–∞–π–¥–∏—Ç–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é —Å–º–µ—Å–∏ (%):`, formula: null },
      { text: '–í—ã—á–∏—Å–ª–∏—Ç–µ, –≤—ã–Ω–æ—Å—è –æ–±—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å:', formula: q6 },
      { text: '–ù–∞–π–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏ –¥–∞–Ω–Ω—ã—Ö x –∏ y:', formula: q7 },
      { text: '–†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ:', formula: q8 },
      { text: `–°–∫–æ–ª—å–∫–æ —Ä–µ–π—Å–æ–≤ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è? ${q9text}`, formula: null },
      { text: `–ù–∞–π–¥–∏—Ç–µ —Ü–µ–ª–æ–µ, –µ—Å–ª–∏ ${q10text}`, formula: null },
      { text: `–ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–∏–º–µ—Ç—Ä –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞. ${q11text}`, formula: null },
    ],
    answers: [a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11],
    variantId: id
  };
}

// ============================================================
// State
// ============================================================
let state = {
  studentName: '',
  variantId: null,
  variantData: null,
  answers: new Array(11).fill(''),
  timerInterval: null,
  secondsLeft: 40 * 60,
  violations: 0,
  annulled: false,
  submitted: false,
  startTime: null
};

// ============================================================
// Screen management
// ============================================================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ============================================================
// START TEST
// ============================================================
function startTest() {
  const sn = document.getElementById('inp-surname').value.trim();
  const nm = document.getElementById('inp-name').value.trim();

  if (!sn || !nm) { alert('–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è'); return; }

  state.studentName = `${sn} ${nm}`;
  state.variantId = rnd(1, 10); // —Å–ª—É—á–∞–π–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
  state.variantData = variant(state.variantId);
  state.startTime = new Date();

  document.getElementById('header-name').textContent = state.studentName;
  document.getElementById('header-variant').textContent = `–í–∞—Ä–∏–∞–Ω—Ç ${state.variantId}`;

  renderQuestions();
  showScreen('screen-test');
  startTimer();
  setupAntiCheat();

  // Attempt fullscreen on mobile
  try { document.documentElement.requestFullscreen && document.documentElement.requestFullscreen(); } catch(e){}
}

// ============================================================
// RENDER QUESTIONS
// ============================================================
function renderQuestions() {
  const container = document.getElementById('questions-container');
  container.innerHTML = '';
  const data = state.variantData;

  data.questions.forEach((q, i) => {
    const card = document.createElement('div');
    card.className = 'question-card';
    card.id = `qcard-${i}`;

    let formulaHtml = '';
    if (q.formula) {
      formulaHtml = `<div class="q-formula">\\[${q.formula}\\]</div>`;
    }

    card.innerHTML = `
      <div class="question-header">
        <div class="q-num">${i+1}</div>
        <div class="q-text">${q.text}</div>
      </div>
      ${formulaHtml}
      <input class="answer-input"
             type="number"
             step="any"
             placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."
             id="ans-${i}"
             oninput="onAnswer(${i}, this)"
             autocomplete="off"
             inputmode="decimal">
    `;

    container.appendChild(card);
  });

  // Render MathJax
  setTimeout(() => {
    if (window.MathJax) MathJax.typesetPromise([container]);
  }, 200);
}

function onAnswer(i, input) {
  state.answers[i] = input.value.trim();
  const card = document.getElementById(`qcard-${i}`);
  if (state.answers[i] !== '') {
    card.classList.add('answered');
    input.classList.add('filled');
  } else {
    card.classList.remove('answered');
    input.classList.remove('filled');
  }
  updateProgress();
}

function updateProgress() {
  const filled = state.answers.filter(a => a !== '').length;
  document.getElementById('ans-count').textContent = filled;
  document.getElementById('progress-fill').style.width = `${(filled/11)*100}%`;
}

// ============================================================
// TIMER
// ============================================================
function startTimer() {
  updateTimerDisplay();
  state.timerInterval = setInterval(() => {
    state.secondsLeft--;
    updateTimerDisplay();
    if (state.secondsLeft <= 0) {
      clearInterval(state.timerInterval);
      document.getElementById('overlay-timeout').classList.add('show');
    }
  }, 1000);
}

function updateTimerDisplay() {
  const m = Math.floor(state.secondsLeft / 60);
  const s = state.secondsLeft % 60;
  const el = document.getElementById('timer-display');
  el.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  el.className = '';
  if (state.secondsLeft <= 300) el.classList.add('danger');
  else if (state.secondsLeft <= 600) el.classList.add('warning');
}

// ============================================================
// ANTI-CHEAT
// ============================================================
function setupAntiCheat() {
  // Block copy
  document.addEventListener('copy', e => e.preventDefault());
  document.addEventListener('cut', e => e.preventDefault());
  document.addEventListener('contextmenu', e => e.preventDefault());

  // Block print screen / screenshots via key
  document.addEventListener('keydown', e => {
    if (e.key === 'PrintScreen' || (e.ctrlKey && e.shiftKey && (e.key==='S'||e.key==='s'))) {
      e.preventDefault();
      recordViolation('screenshot');
    }
    // Block common shortcuts
    if (e.ctrlKey && ['c','a','p','s'].includes(e.key.toLowerCase())) {
      if (e.key.toLowerCase() !== 's') e.preventDefault(); // allow save for inputs
    }
  });

  // Screenshot via visibility change (mobile screenshot)
  document.addEventListener('visibilitychange', () => {
    if (state.submitted || state.annulled) return;
    if (document.visibilityState === 'hidden') {
      recordViolation('tab_switch');
    }
  });

  // Blur = switching apps/tab
  window.addEventListener('blur', () => {
    if (state.submitted || state.annulled) return;
    recordViolation('tab_switch');
  });

  // beforeunload
  window.addEventListener('beforeunload', e => {
    if (state.submitted || state.annulled) return;
    e.preventDefault();
    e.returnValue = '';
  });

  // Block DevTools
  document.addEventListener('keydown', e => {
    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
      e.preventDefault();
    }
  });
}

let lastViolationTime = 0;
function recordViolation(type) {
  if (state.submitted || state.annulled) return;
  const now = Date.now();
  if (now - lastViolationTime < 1500) return; // debounce
  lastViolationTime = now;

  state.violations++;

  const banner = document.getElementById('violation-banner');
  banner.classList.add('show');
  setTimeout(() => banner.classList.remove('show'), 4000);

  if (state.violations > 2) {
    annulWork();
    return;
  }

  const badge = document.getElementById('violation-count-badge');
  badge.textContent = `–ù–∞—Ä—É—à–µ–Ω–∏–µ ${state.violations} –∏–∑ 2`;
  const txt = document.getElementById('violation-modal-text');
  txt.innerHTML = type === 'screenshot'
    ? '–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ —Å–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞. –≠—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ.<br><br>'
    : '–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏ –≤–∫–ª–∞–¥–∫—É. –≠—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ.<br><br>';
  txt.innerHTML += state.violations >= 2
    ? '<b style="color:var(--red)">–≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ! –°–ª–µ–¥—É—é—â–µ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∞–Ω–Ω—É–ª–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É.</b>'
    : '–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞—Ä—É—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞.';

  document.getElementById('overlay-violation').classList.add('show');
}

function dismissViolation() {
  document.getElementById('overlay-violation').classList.remove('show');
}

function annulWork() {
  state.annulled = true;
  clearInterval(state.timerInterval);
  closeAllOverlays();
  // Send annulment to sheets
  sendToSheets(true);
  showScreen('screen-annulled');
}

// ============================================================
// SUBMIT
// ============================================================
function confirmSubmit() {
  const filled = state.answers.filter(a => a !== '').length;
  document.getElementById('confirm-ans').textContent = filled;
  document.getElementById('overlay-confirm').classList.add('show');
}

function submitTest() {
  if (state.submitted) return;
  state.submitted = true;
  clearInterval(state.timerInterval);
  closeAllOverlays();
  showResults();
}

function showResults() {
  const data = state.variantData;
  const correct = data.answers;
  let score = 0;
  const review = [];

  correct.forEach((ans, i) => {
    const userRaw = state.answers[i];
    const userNum = parseFloat(userRaw.replace(',','.'));
    const isCorrect = !isNaN(userNum) && Math.abs(userNum - ans) < 0.05;
    if (isCorrect) score++;
    review.push({ q: i+1, user: userRaw || '‚Äî', correct: ans, ok: isCorrect });
  });

  document.getElementById('res-name').textContent = state.studentName;
  document.getElementById('res-meta').textContent =
    `–í–∞—Ä–∏–∞–Ω—Ç ${state.variantId} ¬∑ ${formatTime(40*60 - state.secondsLeft)} –∑–∞—Ç—Ä–∞—á–µ–Ω–æ`;

  document.getElementById('score-number').textContent = `${score}/11`;
  const pct = Math.round(score/11*100);
  document.getElementById('score-circle').style.setProperty('--pct', `${pct}%`);
  document.getElementById('score-circle').style.background =
    `conic-gradient(${pct>=70?'var(--green)':'var(--accent)'} ${pct}%, var(--surface2) 0%)`;

  const reviewEl = document.getElementById('answers-review');
  reviewEl.innerHTML = review.map(r => `
    <div class="answer-row">
      <span class="q-label">–ó–∞–¥–∞–Ω–∏–µ ${r.q}</span>
      <span class="yours">${r.user}</span>
      <span class="correct-ans">${r.ok ? '' : `‚Üí ${r.correct}`}</span>
      <span class="status">${r.ok ? '‚úÖ' : '‚ùå'}</span>
    </div>
  `).join('');

  showScreen('screen-result');
  sendToSheets(false, score, review);
}

function formatTime(secs) {
  const m = Math.floor(secs/60), s = secs%60;
  return `${m} –º–∏–Ω ${s} —Å–µ–∫`;
}

// ============================================================
// GOOGLE SHEETS
// ============================================================
function sendToSheets(annulled = false, score = 0, review = []) {
  const statusEl = document.getElementById('send-status');

  const timeSpent = state.startTime
    ? Math.round((Date.now() - state.startTime) / 1000)
    : 0;

  const payload = {
    timestamp: new Date().toISOString(),
    name: state.studentName,
    variant: state.variantId,
    score: annulled ? '–ê–ù–ù–£–õ–ò–†–û–í–ê–ù–ê' : score,
    total: 11,
    violations: state.violations,
    timeSpent: timeSpent,
    answers: state.answers.join('; '),
    correct: annulled ? '' : (state.variantData?.answers || []).join('; '),
    details: annulled ? '–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑-–∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π' :
      review.map(r => `${r.q}:${r.ok?'‚úì':'‚úó'}`).join(' ')
  };

  fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  }).then(() => {
    if (statusEl) statusEl.innerHTML = '‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—á–∏—Ç–µ–ª—é';
  }).catch(() => {
    if (statusEl) statusEl.innerHTML = '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü–æ–∫–∞–∂–∏—Ç–µ —ç–∫—Ä–∞–Ω —É—á–∏—Ç–µ–ª—é.';
  });
}

// ============================================================
// Utils
// ============================================================
function closeOverlay(id) {
  document.getElementById(id).classList.remove('show');
}

function closeAllOverlays() {
  document.querySelectorAll('.overlay').forEach(o => o.classList.remove('show'));
}
</script>
</body>
</html>
