<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;800&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0f17;
    --surface: #161824;
    --surface2: #1d2035;
    --accent: #5b7fff;
    --accent2: #ff6b6b;
    --accent3: #4ecdc4;
    --gold: #ffd166;
    --text: #e8eaf6;
    --muted: #6b7280;
    --border: rgba(91,127,255,0.18);
    --radius: 16px;
    --radius-sm: 8px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Jost', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
  }

  /* BG grid */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(91,127,255,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(91,127,255,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .page { position: relative; z-index: 1; }

  /* ============ HEADER ============ */
  .header {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    background: rgba(14,15,23,0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
  }

  .header-title {
    font-family: 'Unbounded', sans-serif;
    font-size: clamp(10px, 3vw, 14px);
    font-weight: 600;
    color: var(--accent);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
  }

  .timer-wrap {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 40px;
    padding: 6px 14px;
    flex-shrink: 0;
  }

  .timer-icon { font-size: 16px; }
  #timer {
    font-family: 'Unbounded', sans-serif;
    font-size: 16px;
    font-weight: 600;
    color: var(--gold);
    letter-spacing: 2px;
    min-width: 52px;
    text-align: center;
  }

  #timer.danger { color: var(--accent2); animation: pulse 1s infinite; }

  @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }

  .warn-badge {
    background: var(--surface2);
    border: 1px solid var(--accent2);
    border-radius: 40px;
    padding: 6px 12px;
    font-size: 12px;
    color: var(--accent2);
    flex-shrink: 0;
    font-weight: 500;
  }

  /* ============ MAIN ============ */
  .main {
    padding: 90px 16px 40px;
    max-width: 680px;
    margin: 0 auto;
  }

  /* ============ SCREEN: LOGIN ============ */
  #screen-login {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 24px;
    text-align: center;
  }

  .login-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 40px 32px;
    max-width: 420px;
    width: 100%;
    box-shadow: 0 0 60px rgba(91,127,255,0.08);
  }

  .login-logo {
    font-family: 'Unbounded', sans-serif;
    font-size: 32px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--accent), var(--accent3));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 8px;
  }

  .login-sub {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 32px;
  }

  .field-label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    color: var(--muted);
    text-align: left;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
  }

  .field-input {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px 16px;
    font-family: 'Jost', sans-serif;
    font-size: 16px;
    color: var(--text);
    outline: none;
    margin-bottom: 16px;
    transition: border-color 0.2s;
  }

  .field-input:focus { border-color: var(--accent); }

  .btn-primary {
    width: 100%;
    background: linear-gradient(135deg, var(--accent), #7b5ea7);
    border: none;
    border-radius: var(--radius-sm);
    padding: 16px;
    font-family: 'Unbounded', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    margin-top: 8px;
  }

  .btn-primary:hover { opacity: 0.9; }
  .btn-primary:active { transform: scale(0.98); }

  /* ============ TASK CARDS ============ */
  .task-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.3);
  }

  .task-tag {
    display: inline-block;
    background: linear-gradient(135deg, var(--accent), #7b5ea7);
    border-radius: 40px;
    padding: 4px 14px;
    font-family: 'Unbounded', sans-serif;
    font-size: 10px;
    font-weight: 600;
    color: #fff;
    margin-bottom: 12px;
    letter-spacing: 0.5px;
  }

  .task-title {
    font-family: 'Unbounded', sans-serif;
    font-size: clamp(14px, 4vw, 18px);
    font-weight: 600;
    margin-bottom: 16px;
    line-height: 1.4;
  }

  /* Numbers display */
  .numbers-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 16px 0;
    justify-content: center;
  }

  .num-chip {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 8px 12px;
    font-family: 'Unbounded', sans-serif;
    font-size: 14px;
    font-weight: 400;
    color: var(--accent3);
    min-width: 46px;
    text-align: center;
  }

  /* Answer fields */
  .answer-group {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .answer-row {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
  }

  .answer-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--muted);
    flex: 1;
    min-width: 80px;
  }

  .answer-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 2px 10px;
    font-size: 11px;
    color: var(--gold);
    font-weight: 600;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .answer-input {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    font-family: 'Jost', sans-serif;
    font-size: 16px;
    color: var(--text);
    outline: none;
    width: 110px;
    text-align: center;
    transition: border-color 0.2s;
    flex-shrink: 0;
  }

  .answer-input:focus { border-color: var(--accent); }

  /* ============ TASK 2 ‚Äî CHART ============ */
  .chart-section { margin-top: 20px; }

  .intervals-info {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 16px;
  }

  .interval-chip {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px 10px;
    font-size: 12px;
    color: var(--muted);
  }

  .interval-chip span {
    color: var(--accent);
    font-weight: 600;
  }

  .chart-container {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    gap: 10px;
    height: 220px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 16px 12px 8px;
    margin-bottom: 20px;
    position: relative;
  }

  /* Y-axis lines */
  .chart-container::before {
    content: '';
    position: absolute;
    inset: 16px 12px 28px;
    background-image: repeating-linear-gradient(
      to top,
      transparent,
      transparent calc(20% - 1px),
      rgba(91,127,255,0.12) calc(20% - 1px),
      rgba(91,127,255,0.12) 20%
    );
    pointer-events: none;
  }

  .bar-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    flex: 1;
    height: 100%;
    position: relative;
    z-index: 1;
  }

  .bar-count {
    font-family: 'Unbounded', sans-serif;
    font-size: 10px;
    color: var(--gold);
    min-height: 16px;
    text-align: center;
  }

  .bar-track {
    flex: 1;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    cursor: pointer;
  }

  .bar-fill {
    background: linear-gradient(to top, var(--accent), var(--accent3));
    border-radius: 4px 4px 0 0;
    width: 100%;
    transition: height 0.2s;
    min-height: 2px;
    position: relative;
  }

  .bar-fill::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to right, rgba(255,255,255,0.1), transparent);
    border-radius: inherit;
  }

  .bar-label {
    font-size: 10px;
    color: var(--muted);
    text-align: center;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .slider-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    margin-top: 8px;
  }

  .bar-slider {
    width: 100%;
    -webkit-appearance: none;
    appearance: none;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    outline: none;
    cursor: pointer;
  }

  .bar-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 2px solid var(--bg);
    box-shadow: 0 0 8px rgba(91,127,255,0.5);
  }

  .target-hint {
    background: rgba(255,209,102,0.08);
    border: 1px dashed rgba(255,209,102,0.3);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    font-size: 12px;
    color: var(--muted);
    text-align: center;
    margin-bottom: 12px;
  }

  .target-hint strong { color: var(--gold); }

  /* ============ SUBMIT ============ */
  .submit-section {
    text-align: center;
    margin-top: 32px;
    padding-bottom: 40px;
  }

  .btn-submit {
    background: linear-gradient(135deg, var(--accent3), var(--accent));
    border: none;
    border-radius: var(--radius-sm);
    padding: 18px 48px;
    font-family: 'Unbounded', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    width: 100%;
    max-width: 320px;
    box-shadow: 0 8px 32px rgba(78,205,196,0.3);
  }

  .btn-submit:hover { opacity: 0.9; }
  .btn-submit:active { transform: scale(0.98); }

  /* ============ OVERLAY ============ */
  .overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(14,15,23,0.92);
    backdrop-filter: blur(8px);
    z-index: 200;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }

  .overlay.active { display: flex; }

  .overlay-card {
    background: var(--surface);
    border: 2px solid var(--accent2);
    border-radius: 24px;
    padding: 36px 32px;
    max-width: 400px;
    width: 100%;
    text-align: center;
    box-shadow: 0 0 60px rgba(255,107,107,0.2);
    animation: pop 0.3s ease;
  }

  @keyframes pop {
    from { transform: scale(0.85); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .overlay-icon { font-size: 48px; margin-bottom: 16px; }

  .overlay-title {
    font-family: 'Unbounded', sans-serif;
    font-size: 18px;
    font-weight: 700;
    color: var(--accent2);
    margin-bottom: 12px;
  }

  .overlay-text {
    font-size: 15px;
    color: var(--text);
    line-height: 1.6;
    margin-bottom: 24px;
  }

  .warn-count {
    font-family: 'Unbounded', sans-serif;
    font-size: 28px;
    font-weight: 800;
    color: var(--accent2);
    display: block;
    margin: 8px 0;
  }

  .btn-dismiss {
    background: var(--accent2);
    border: none;
    border-radius: var(--radius-sm);
    padding: 14px 32px;
    font-family: 'Unbounded', sans-serif;
    font-size: 13px;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
    transition: opacity 0.2s;
    width: 100%;
  }

  .btn-dismiss:hover { opacity: 0.85; }

  /* ============ RESULT SCREEN ============ */
  #screen-result {
    display: none;
    padding: 90px 24px 40px;
    max-width: 560px;
    margin: 0 auto;
    text-align: center;
  }

  .result-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 40px 32px;
    margin-bottom: 24px;
  }

  .grade-display {
    font-family: 'Unbounded', sans-serif;
    font-size: 80px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--gold), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1;
    margin-bottom: 12px;
  }

  .grade-label {
    font-size: 18px;
    color: var(--muted);
    margin-bottom: 24px;
  }

  .score-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
    font-size: 15px;
  }

  .score-row:last-child { border-bottom: none; }

  .score-val {
    font-family: 'Unbounded', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: var(--accent3);
  }

  .result-note {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.6;
    margin-top: 16px;
  }

  .annulled {
    background: rgba(255,107,107,0.1);
    border: 2px solid var(--accent2);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
    font-family: 'Unbounded', sans-serif;
    font-size: 16px;
    color: var(--accent2);
    font-weight: 600;
  }

  /* ============ SENDING ============ */
  .sending-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(14,15,23,0.95);
    z-index: 300;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
    font-family: 'Unbounded', sans-serif;
    font-size: 14px;
    color: var(--muted);
  }

  .sending-overlay.active { display: flex; }

  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* Readonly look */
  input[readonly] { opacity: 0.6; cursor: not-allowed; }

  /* Correct/wrong coloring after submit */
  .correct .answer-input { border-color: var(--accent3); color: var(--accent3); }
  .wrong .answer-input { border-color: var(--accent2); color: var(--accent2); }

  @media (max-width: 480px) {
    .login-card { padding: 28px 20px; }
    .task-card { padding: 18px 14px; }
    .answer-row { flex-wrap: wrap; gap: 8px; }
    .answer-input { width: 90px; }
  }
</style>
</head>
<body>

<!-- ========== HEADER ========== -->
<div class="header" id="main-header" style="display:none">
  <div class="header-title" id="student-name-display">–£—á–µ–Ω–∏–∫</div>
  <div class="warn-badge" id="warn-display">‚ö†Ô∏è 0</div>
  <div class="timer-wrap">
    <span class="timer-icon">‚è±</span>
    <span id="timer">20:00</span>
  </div>
</div>

<!-- ========== LOGIN SCREEN ========== -->
<div id="screen-login" class="page">
  <div class="login-card">
    <div class="login-logo">üìä –°—Ç–∞—Ç</div>
    <div class="login-sub">–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ<br>–í—Ä–µ–º—è: 20 –º–∏–Ω—É—Ç</div>
    <label class="field-label" for="inp-last">–§–∞–º–∏–ª–∏—è</label>
    <input class="field-input" type="text" id="inp-last" placeholder="–ò–≤–∞–Ω–æ–≤" autocomplete="family-name">
    <label class="field-label" for="inp-first">–ò–º—è</label>
    <input class="field-input" type="text" id="inp-first" placeholder="–ò–≤–∞–Ω" autocomplete="given-name">
    <div style="font-size:12px;color:var(--muted);margin-bottom:12px;text-align:left;">
      ‚ö†Ô∏è –ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –Ω–µ–ª—å–∑—è –ø–æ–∫–∏–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.<br>
      üìµ –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω—ã.<br>
      ‚è∞ 20 –º–∏–Ω—É—Ç ‚Äî –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ç–∞–π–º–µ—Ä.
    </div>
    <button class="btn-primary" onclick="startQuiz()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚Üí</button>
  </div>
</div>

<!-- ========== QUIZ SCREEN ========== -->
<div id="screen-quiz" class="page" style="display:none">
  <div class="main">

    <!-- TASK 1 -->
    <div class="task-card">
      <span class="task-tag">–ó–∞–¥–∞–Ω–∏–µ 1 ¬∑ 3 –±–∞–ª–ª–∞</span>
      <div class="task-title">–ê–Ω–∞–ª–∏–∑ —á–∏—Å–ª–æ–≤–æ–≥–æ —Ä—è–¥–∞</div>
      <p style="font-size:14px;color:var(--muted);margin-bottom:8px;">–î–∞–Ω –Ω–∞–±–æ—Ä –∏–∑ 20 —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª. –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏.</p>
      <div class="numbers-grid" id="task1-numbers"></div>
      <div class="answer-group">
        <div class="answer-row" id="row-mean">
          <span class="answer-label">–°—Ä–µ–¥–Ω–µ–µ</span>
          <span class="answer-badge">1 –±–∞–ª–ª</span>
          <input class="answer-input" type="number" id="ans-mean" placeholder="0" step="0.01">
        </div>
        <div class="answer-row" id="row-median">
          <span class="answer-label">–ú–µ–¥–∏–∞–Ω–∞</span>
          <span class="answer-badge">1 –±–∞–ª–ª</span>
          <input class="answer-input" type="number" id="ans-median" placeholder="0" step="0.01">
        </div>
        <div class="answer-row" id="row-range">
          <span class="answer-label">–†–∞–∑–º–∞—Ö</span>
          <span class="answer-badge">1 –±–∞–ª–ª</span>
          <input class="answer-input" type="number" id="ans-range" placeholder="0">
        </div>
      </div>
    </div>

    <!-- TASK 2 -->
    <div class="task-card">
      <span class="task-tag">–ó–∞–¥–∞–Ω–∏–µ 2 ¬∑ 3 –±–∞–ª–ª–∞</span>
      <div class="task-title">–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã</div>
      <p style="font-size:14px;color:var(--muted);margin-bottom:12px;">–î–∞–Ω –Ω–∞–±–æ—Ä –∏–∑ 20 –∑–Ω–∞—á–µ–Ω–∏–π. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É (6 —Å—Ç–æ–ª–±–∏–∫–æ–≤), –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ–ª–∑—É–Ω–∫–∏. –ó–∞—Ç–µ–º –Ω–∞–π–¥–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –∏ –º–µ–¥–∏–∞–Ω—É.</p>
      <div class="numbers-grid" id="task2-numbers"></div>
      <div class="intervals-info" id="intervals-info"></div>
      <div class="target-hint" id="target-hint">
        –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —á–∏—Å–ª–∞ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º: <strong>—Å—É–º–º–∞ –≤—Å–µ—Ö —Å—Ç–æ–ª–±–∏–∫–æ–≤ = 20</strong>
      </div>
      <div class="chart-section">
        <div class="chart-container" id="chart-container"></div>
        <div style="display:flex;gap:10px;margin-bottom:16px;" id="sliders-row"></div>
      </div>
      <div id="dist-score-info" style="font-size:12px;color:var(--muted);margin-bottom:8px;text-align:center;"></div>
      <div class="answer-group">
        <div class="answer-row" id="row-mean2">
          <span class="answer-label">–°—Ä–µ–¥–Ω–µ–µ</span>
          <span class="answer-badge">1 –±–∞–ª–ª</span>
          <input class="answer-input" type="number" id="ans-mean2" placeholder="0" step="0.01">
        </div>
        <div class="answer-row" id="row-median2">
          <span class="answer-label">–ú–µ–¥–∏–∞–Ω–∞</span>
          <span class="answer-badge">1 –±–∞–ª–ª</span>
          <input class="answer-input" type="number" id="ans-median2" placeholder="0" step="0.01">
        </div>
      </div>
    </div>

    <div class="submit-section">
      <button class="btn-submit" onclick="submitQuiz()">–°–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚úì</button>
    </div>
  </div>
</div>

<!-- ========== RESULT SCREEN ========== -->
<div id="screen-result" class="page">
  <div style="max-width:560px;margin:0 auto;padding:0 16px;">
    <div id="result-annulled" class="annulled" style="display:none">
      üö´ –†–∞–±–æ—Ç–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞<br><span style="font-size:13px;font-weight:400;color:var(--text);">3 –∏ –±–æ–ª–µ–µ –∑–∞–º–µ—á–∞–Ω–∏–π</span>
    </div>
    <div class="result-card" id="result-card">
      <div class="grade-display" id="result-grade">‚Äî</div>
      <div class="grade-label">–ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞</div>
      <div class="score-row">
        <span>–ó–∞–¥–∞–Ω–∏–µ 1: –°—Ä–µ–¥–Ω–µ–µ</span>
        <span class="score-val" id="r-mean">‚Äî</span>
      </div>
      <div class="score-row">
        <span>–ó–∞–¥–∞–Ω–∏–µ 1: –ú–µ–¥–∏–∞–Ω–∞</span>
        <span class="score-val" id="r-median">‚Äî</span>
      </div>
      <div class="score-row">
        <span>–ó–∞–¥–∞–Ω–∏–µ 1: –†–∞–∑–º–∞—Ö</span>
        <span class="score-val" id="r-range">‚Äî</span>
      </div>
      <div class="score-row">
        <span>–ó–∞–¥–∞–Ω–∏–µ 2: –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞</span>
        <span class="score-val" id="r-hist">‚Äî</span>
      </div>
      <div class="score-row">
        <span>–ó–∞–¥–∞–Ω–∏–µ 2: –°—Ä–µ–¥–Ω–µ–µ</span>
        <span class="score-val" id="r-mean2">‚Äî</span>
      </div>
      <div class="score-row">
        <span>–ó–∞–¥–∞–Ω–∏–µ 2: –ú–µ–¥–∏–∞–Ω–∞</span>
        <span class="score-val" id="r-median2">‚Äî</span>
      </div>
      <div class="score-row" style="margin-top:8px;border-top:2px solid var(--border);">
        <span style="font-weight:600;">–ò—Ç–æ–≥–æ –±–∞–ª–ª–æ–≤</span>
        <span class="score-val" id="r-total">‚Äî</span>
      </div>
      <div class="score-row">
        <span>–ó–∞–º–µ—á–∞–Ω–∏–π</span>
        <span class="score-val" style="color:var(--accent2)" id="r-warns">‚Äî</span>
      </div>
      <p class="result-note" id="r-note"></p>
    </div>
    <p style="font-size:13px;color:var(--muted);text-align:center;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—á–∏—Ç–µ–ª—é. –ú–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
  </div>
</div>

<!-- ========== OVERLAYS ========== -->
<div class="overlay" id="overlay-warn">
  <div class="overlay-card">
    <div class="overlay-icon">‚ö†Ô∏è</div>
    <div class="overlay-title">–ó–∞–º–µ—á–∞–Ω–∏–µ!</div>
    <div class="overlay-text">
      –í—ã –ø–æ–∫–∏–Ω—É–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É.<br>
      <span class="warn-count" id="overlay-warn-count">1</span>
      –∑–∞–º–µ—á–∞–Ω–∏–µ(–π) –ø–æ–ª—É—á–µ–Ω–æ
      <br><span style="font-size:13px;color:var(--muted)" id="overlay-warn-sub"></span>
    </div>
    <button class="btn-dismiss" onclick="dismissWarning()">–ü–æ–Ω—è–ª(–∞), –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>
</div>

<div class="overlay" id="overlay-annulled">
  <div class="overlay-card" style="border-color:var(--accent2)">
    <div class="overlay-icon">üö´</div>
    <div class="overlay-title">–†–∞–±–æ—Ç–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞</div>
    <div class="overlay-text">
      –í—ã –ø–æ–ª—É—á–∏–ª–∏ 3 –∏ –±–æ–ª–µ–µ –∑–∞–º–µ—á–∞–Ω–∏–π. –†–∞–±–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞.
    </div>
    <button class="btn-dismiss" onclick="forceSubmit()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
  </div>
</div>

<div class="overlay" id="overlay-timeout">
  <div class="overlay-card" style="border-color:var(--gold)">
    <div class="overlay-icon">‚è∞</div>
    <div class="overlay-title">–í—Ä–µ–º—è –≤—ã—à–ª–æ!</div>
    <div class="overlay-text">20 –º–∏–Ω—É—Ç –∏—Å—Ç–µ–∫–ª–æ. –†–∞–±–æ—Ç–∞ —Å–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
    <button class="btn-dismiss" onclick="forceSubmit()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
  </div>
</div>

<!-- ========== SENDING ========== -->
<div class="sending-overlay" id="sending-overlay">
  <div class="spinner"></div>
  <span>–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤‚Ä¶</span>
</div>

<script>
// ==========================================
// GOOGLE SHEETS CONFIGURATION
// Replace with your deployed Apps Script URL
// ==========================================
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';

// ==========================================
// STATE
// ==========================================
let studentName = '';
let timerInterval = null;
let secondsLeft = 20 * 60;
let warnings = 0;
let quizActive = false;
let quizSubmitted = false;

// Task 1 data
let t1_numbers = [];
let t1_correct = { mean: 0, median: 0, range: 0 };

// Task 2 data
let t2_numbers = [];
let t2_correct = { mean: 0, median: 0 };
let t2_intervals = [];
let t2_correctDist = [];
let sliderValues = [0,0,0,0,0,0];

// ==========================================
// ANTI-COPY
// ==========================================
document.addEventListener('copy', e => e.preventDefault());
document.addEventListener('cut', e => e.preventDefault());
document.addEventListener('contextmenu', e => { if(quizActive) e.preventDefault(); });
document.addEventListener('keydown', e => {
  if (!quizActive) return;
  if (e.key === 'PrintScreen') {
    e.preventDefault();
    navigator.clipboard?.writeText('').catch(()=>{});
  }
  if ((e.ctrlKey||e.metaKey) && ['c','x','a','p','s'].includes(e.key.toLowerCase())) {
    // allow ctrl+a only in inputs
    if (e.key.toLowerCase() === 'a') return;
    e.preventDefault();
  }
});

// Screenshot detection via visibility / blur
document.addEventListener('visibilitychange', () => {
  if (!quizActive || quizSubmitted) return;
  if (document.hidden) triggerWarning();
});

window.addEventListener('blur', () => {
  if (!quizActive || quizSubmitted) return;
  triggerWarning();
});

// beforeunload
window.addEventListener('beforeunload', e => {
  if (!quizActive || quizSubmitted) return;
  e.preventDefault();
  e.returnValue = '';
});

// ==========================================
// WARNINGS
// ==========================================
function triggerWarning() {
  warnings++;
  document.getElementById('warn-display').textContent = `‚ö†Ô∏è ${warnings}`;
  document.getElementById('overlay-warn-count').textContent = warnings;

  let sub = '';
  if (warnings >= 3) {
    sub = '–†–∞–±–æ—Ç–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞!';
  } else if (warnings === 2) {
    sub = '–ï—â—ë –æ–¥–Ω–æ ‚Äî —Ä–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞. ‚àí1 –±–∞–ª–ª —É–∂–µ –ø—Ä–∏–º–µ–Ω—ë–Ω.';
  } else {
    sub = '2 –∑–∞–º–µ—á–∞–Ω–∏—è = ‚àí1 –±–∞–ª–ª. 3 = –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ.';
  }
  document.getElementById('overlay-warn-sub').textContent = sub;
  document.getElementById('overlay-warn').classList.add('active');
}

function dismissWarning() {
  document.getElementById('overlay-warn').classList.remove('active');
  if (warnings >= 3) {
    document.getElementById('overlay-warn').classList.remove('active');
    document.getElementById('overlay-annulled').classList.add('active');
  }
}

function forceSubmit() {
  document.getElementById('overlay-annulled').classList.remove('active');
  document.getElementById('overlay-timeout').classList.remove('active');
  submitQuiz(true);
}

// ==========================================
// GENERATE DATA
// ==========================================
function randInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function generateTask1() {
  const nums = Array.from({length:20}, () => randInt(1, 99));
  t1_numbers = nums;
  const sorted = [...nums].sort((a,b) => a-b);

  const mean = nums.reduce((s,n) => s+n, 0) / 20;
  const median = (sorted[9] + sorted[10]) / 2;
  const range = sorted[19] - sorted[0];

  t1_correct = {
    mean: Math.round(mean * 100) / 100,
    median: Math.round(median * 100) / 100,
    range
  };

  const grid = document.getElementById('task1-numbers');
  grid.innerHTML = nums.map(n => `<div class="num-chip">${n}</div>`).join('');
}

function generateTask2() {
  const nums = Array.from({length:20}, () => randInt(1, 60));
  t2_numbers = nums;

  // 6 intervals: 1-10, 11-20, 21-30, 31-40, 41-50, 51-60
  const breaks = [1,11,21,31,41,51,61];
  t2_intervals = breaks.slice(0,-1).map((b,i) => [b, breaks[i+1]-1]);
  t2_correctDist = t2_intervals.map(([lo,hi]) => nums.filter(n => n>=lo && n<=hi).length);

  const sorted = [...nums].sort((a,b) => a-b);
  const mean = Math.round(nums.reduce((s,n) => s+n, 0) / 20 * 100) / 100;
  const median = Math.round((sorted[9] + sorted[10]) / 2 * 100) / 100;
  t2_correct = { mean, median };

  // display numbers
  document.getElementById('task2-numbers').innerHTML =
    nums.map(n => `<div class="num-chip">${n}</div>`).join('');

  // intervals info
  document.getElementById('intervals-info').innerHTML =
    t2_intervals.map(([lo,hi], i) =>
      `<div class="interval-chip">–ò${i+1}: ${lo}‚Äì${hi} <span>(${t2_correctDist[i]})</span></div>`
    ).join('');
  // Note: showing correct counts for reference ‚Äî in real exam hide them
  // If you want to hide, remove <span> above

  buildChart();
}

function buildChart() {
  const container = document.getElementById('chart-container');
  const slidersRow = document.getElementById('sliders-row');
  container.innerHTML = '';
  slidersRow.innerHTML = '';
  sliderValues = [0,0,0,0,0,0];

  const maxVal = 20;

  t2_intervals.forEach(([lo,hi], i) => {
    // Bar column
    const wrap = document.createElement('div');
    wrap.className = 'bar-wrapper';
    wrap.innerHTML = `
      <div class="bar-count" id="bc-${i}">0</div>
      <div class="bar-track" id="bt-${i}">
        <div class="bar-fill" id="bf-${i}" style="height:0%"></div>
      </div>
      <div class="bar-label">${lo}‚Äì${hi}</div>
    `;
    container.appendChild(wrap);

    // Slider below
    const sw = document.createElement('div');
    sw.className = 'slider-wrap';
    sw.style.flex = '1';
    sw.innerHTML = `
      <input type="range" class="bar-slider" id="sl-${i}"
        min="0" max="${maxVal}" value="0"
        oninput="updateBar(${i}, this.value)">
      <div style="font-size:10px;color:var(--muted);">${lo}‚Äì${hi}</div>
    `;
    slidersRow.appendChild(sw);
  });

  updateDistInfo();
}

function updateBar(i, val) {
  sliderValues[i] = parseInt(val);
  document.getElementById('bc-'+i).textContent = val;
  const pct = (val / 20 * 100);
  document.getElementById('bf-'+i).style.height = pct + '%';
  updateDistInfo();
}

function updateDistInfo() {
  const total = sliderValues.reduce((s,v) => s+v, 0);
  const info = document.getElementById('dist-score-info');
  const color = total === 20 ? 'var(--accent3)' : total > 20 ? 'var(--accent2)' : 'var(--gold)';
  info.innerHTML = `–°—É–º–º–∞ —Å—Ç–æ–ª–±–∏–∫–æ–≤: <span style="color:${color};font-weight:700;font-family:'Unbounded',sans-serif;">${total}</span> / 20`;
}

// ==========================================
// TIMER
// ==========================================
function startTimer() {
  timerInterval = setInterval(() => {
    secondsLeft--;
    const m = Math.floor(secondsLeft / 60);
    const s = secondsLeft % 60;
    const el = document.getElementById('timer');
    el.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    if (secondsLeft <= 60) el.classList.add('danger');
    if (secondsLeft <= 0) {
      clearInterval(timerInterval);
      document.getElementById('overlay-timeout').classList.add('active');
    }
  }, 1000);
}

// ==========================================
// START
// ==========================================
function startQuiz() {
  const last = document.getElementById('inp-last').value.trim();
  const first = document.getElementById('inp-first').value.trim();
  if (!last || !first) { alert('–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è!'); return; }
  studentName = `${last} ${first}`;
  document.getElementById('student-name-display').textContent = studentName;

  document.getElementById('screen-login').style.display = 'none';
  document.getElementById('screen-quiz').style.display = 'block';
  document.getElementById('main-header').style.display = 'flex';
  quizActive = true;

  generateTask1();
  generateTask2();
  startTimer();
}

// ==========================================
// SUBMIT
// ==========================================
function submitQuiz(forced = false) {
  if (quizSubmitted) return;
  quizSubmitted = true;
  quizActive = false;
  clearInterval(timerInterval);

  const annulled = warnings >= 3;

  // Score calc
  const userMean   = parseFloat(document.getElementById('ans-mean').value);
  const userMedian = parseFloat(document.getElementById('ans-median').value);
  const userRange  = parseFloat(document.getElementById('ans-range').value);
  const userMean2   = parseFloat(document.getElementById('ans-mean2').value);
  const userMedian2 = parseFloat(document.getElementById('ans-median2').value);

  const eps = 0.1;
  let s1 = +(!isNaN(userMean)   && Math.abs(userMean   - t1_correct.mean)   < eps + 0.01);
  let s2 = +(!isNaN(userMedian) && Math.abs(userMedian - t1_correct.median) < eps + 0.01);
  let s3 = +(!isNaN(userRange)  && Math.abs(userRange  - t1_correct.range)  < 0.5);

  // Histogram score: count correct bins (allow ¬±1)
  const correctBins = sliderValues.filter((v,i) => Math.abs(v - t2_correctDist[i]) <= 1).length;
  let s4 = correctBins >= 5 ? 1 : 0;  // at least 5/6 correct bins

  let s5 = +(!isNaN(userMean2)   && Math.abs(userMean2   - t2_correct.mean)   < eps + 0.01);
  let s6 = +(!isNaN(userMedian2) && Math.abs(userMedian2 - t2_correct.median) < eps + 0.01);

  let total = s1+s2+s3+s4+s5+s6;

  // Penalties
  if (warnings >= 2) total = Math.max(0, total - 1);

  let grade = '‚Äî';
  if (!annulled) {
    if (total >= 6) grade = '5';
    else if (total === 5) grade = '4';
    else if (total >= 3) grade = '3';
    else grade = '2';
  }

  // Mark answers
  markAnswer('row-mean',   s1);
  markAnswer('row-median', s2);
  markAnswer('row-range',  s3);
  markAnswer('row-hist',   s4); // doesn't exist, skip
  markAnswer('row-mean2',  s5);
  markAnswer('row-median2',s6);

  // Show result
  document.getElementById('screen-quiz').style.display = 'none';
  document.getElementById('screen-result').style.display = 'block';

  if (annulled) {
    document.getElementById('result-annulled').style.display = 'block';
    document.getElementById('result-card').style.display = 'none';
  } else {
    document.getElementById('result-grade').textContent = grade;
    document.getElementById('r-mean').textContent    = s1 ? '‚úÖ 1/1' : `‚ùå 0/1 (–≤–µ—Ä–Ω–æ: ${t1_correct.mean})`;
    document.getElementById('r-median').textContent  = s2 ? '‚úÖ 1/1' : `‚ùå 0/1 (–≤–µ—Ä–Ω–æ: ${t1_correct.median})`;
    document.getElementById('r-range').textContent   = s3 ? '‚úÖ 1/1' : `‚ùå 0/1 (–≤–µ—Ä–Ω–æ: ${t1_correct.range})`;
    document.getElementById('r-hist').textContent    = s4 ? '‚úÖ 1/1' : `‚ùå 0/1 (–≤–µ—Ä–Ω–æ: ${t2_correctDist.join(',')})`;
    document.getElementById('r-mean2').textContent   = s5 ? '‚úÖ 1/1' : `‚ùå 0/1 (–≤–µ—Ä–Ω–æ: ${t2_correct.mean})`;
    document.getElementById('r-median2').textContent = s6 ? '‚úÖ 1/1' : `‚ùå 0/1 (–≤–µ—Ä–Ω–æ: ${t2_correct.median})`;
    document.getElementById('r-total').textContent   = `${total} / 6`;
    document.getElementById('r-warns').textContent   = warnings;
    const notes = warnings >= 2 ? `–ó–∞–º–µ—á–∞–Ω–∏—è: –ø—Ä–∏–º–µ–Ω—ë–Ω —à—Ç—Ä–∞—Ñ ‚àí1 –±–∞–ª–ª. ` : '';
    document.getElementById('r-note').textContent = notes + `–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã: —Å—Ä–µ–¥–Ω–µ–µ=${t1_correct.mean}, –º–µ–¥–∏–∞–Ω–∞=${t1_correct.median}, —Ä–∞–∑–º–∞—Ö=${t1_correct.range}`;
  }

  // Send to Google Sheets
  sendResults({
    name: studentName,
    grade: annulled ? '–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–æ' : grade,
    total: annulled ? 0 : total,
    warnings,
    t1_mean_user: userMean, t1_mean_correct: t1_correct.mean,
    t1_median_user: userMedian, t1_median_correct: t1_correct.median,
    t1_range_user: userRange, t1_range_correct: t1_correct.range,
    t2_dist_user: sliderValues.join(','), t2_dist_correct: t2_correctDist.join(','),
    t2_mean_user: userMean2, t2_mean_correct: t2_correct.mean,
    t2_median_user: userMedian2, t2_median_correct: t2_correct.median,
    annulled,
    t1_numbers: t1_numbers.join(','),
    t2_numbers: t2_numbers.join(','),
    timestamp: new Date().toISOString()
  });
}

function markAnswer(rowId, correct) {
  const el = document.getElementById(rowId);
  if (!el) return;
  el.classList.add(correct ? 'correct' : 'wrong');
  const inp = el.querySelector('.answer-input');
  if (inp) inp.setAttribute('readonly', '');
}

// ==========================================
// SEND TO GOOGLE SHEETS
// ==========================================
async function sendResults(data) {
  document.getElementById('sending-overlay').classList.add('active');
  try {
    await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
  } catch(e) {
    console.error('Send failed:', e);
  }
  document.getElementById('sending-overlay').classList.remove('active');
}
</script>

<!-- ==========================================
GOOGLE APPS SCRIPT (paste in Apps Script editor):

function doPost(e) {
  const data = JSON.parse(e.postData.contents);
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã') 
    || SpreadsheetApp.getActiveSpreadsheet().insertSheet('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã');

  if (sheet.getLastRow() === 0) {
    sheet.appendRow([
      '–í—Ä–µ–º—è', '–£—á–µ–Ω–∏–∫', '–û—Ü–µ–Ω–∫–∞', '–ë–∞–ª–ª–æ–≤', '–ó–∞–º–µ—á–∞–Ω–∏–π', '–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–æ',
      '–°—Ä.1(—É—á)', '–°—Ä.1(–≤–µ—Ä–Ω)', '–ú–µ–¥.1(—É—á)', '–ú–µ–¥.1(–≤–µ—Ä–Ω)', '–†–∞–∑–º(—É—á)', '–†–∞–∑–º(–≤–µ—Ä–Ω)',
      '–ì–∏—Å—Ç(—É—á)', '–ì–∏—Å—Ç(–≤–µ—Ä–Ω)', '–°—Ä.2(—É—á)', '–°—Ä.2(–≤–µ—Ä–Ω)', '–ú–µ–¥.2(—É—á)', '–ú–µ–¥.2(–≤–µ—Ä–Ω)',
      '–ß–∏—Å–ª–∞ –∑–∞–¥–∞–Ω–∏–µ1', '–ß–∏—Å–ª–∞ –∑–∞–¥–∞–Ω–∏–µ2'
    ]);
  }

  sheet.appendRow([
    data.timestamp, data.name, data.grade, data.total, data.warnings, data.annulled,
    data.t1_mean_user, data.t1_mean_correct,
    data.t1_median_user, data.t1_median_correct,
    data.t1_range_user, data.t1_range_correct,
    data.t2_dist_user, data.t2_dist_correct,
    data.t2_mean_user, data.t2_mean_correct,
    data.t2_median_user, data.t2_median_correct,
    data.t1_numbers, data.t2_numbers
  ]);

  return ContentService.createTextOutput(JSON.stringify({status:'ok'}))
    .setMimeType(ContentService.MimeType.JSON);
}
=========================================== -->

</body>
</html>
